<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel | La Previa Maldita</title>
    <link rel="stylesheet" href="../assets/css/admin.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="shortcut icon" href="../assets/images/ico-removebg-preview2.ico" type="image/x-icon">
</head>

<body>
    <!-- ============================================================ -->
    <!-- MOBILE TOP BAR (solo visible en m√≥vil ‚â§768px)               -->
    <!-- ============================================================ -->
    <header class="mobile-topbar">
        <div class="mob-logo">
            <img src="../assets/images/image logo.png" alt="Logo">
            <span class="mob-section-title" id="mobSectionTitle">Dashboard</span>
        </div>
        <div class="mob-right">
            <div class="mob-avatar" id="mobAdminAvatar">A</div>
            <button class="mob-logout" onclick="logoutAdmin()">Salir</button>
        </div>
    </header>

    <!-- ============================================================ -->
    <!-- BOTTOM NAVIGATION BAR (solo visible en m√≥vil ‚â§768px)        -->
    <!-- ============================================================ -->
    <nav class="bottom-nav" id="bottomNav">
        <button class="bottom-nav-item active" onclick="switchSection('dashboard')" data-section="dashboard">
            <span class="bnav-icon">üìä</span>
            <span class="bnav-label">Inicio</span>
        </button>
        <button class="bottom-nav-item" onclick="switchSection('users')" data-section="users">
            <span class="bnav-icon">üë•</span>
            <span class="bnav-label">Usuarios</span>
        </button>
        <button class="bottom-nav-item" onclick="switchSection('entradas')" data-section="entradas">
            <span class="bnav-icon">üé´</span>
            <span class="bnav-label">Entradas</span>
        </button>
        <button class="bottom-nav-item" onclick="switchSection('products')" data-section="products">
            <span class="bnav-icon">üõçÔ∏è</span>
            <span class="bnav-label">Productos</span>
        </button>
        <button class="bottom-nav-item" onclick="switchSection('orders')" data-section="orders">
            <span class="bnav-icon">üì¶</span>
            <span class="bnav-label">Pedidos</span>
        </button>
        <button class="bottom-nav-item" onclick="switchSection('tickets')" data-section="tickets">
            <span class="bnav-icon">üéüÔ∏è</span>
            <span class="bnav-label">QR</span>
        </button>
    </nav>

    <!-- Sidebar -->

    <aside class="admin-sidebar">
        <div class="sidebar-header">
            <div class="logo">
                <img src="../assets/images/image logo.png" alt="Logo" class="logo-image">
                <span class="logo-text">Admin Panel</span>
            </div>
        </div>

        <nav class="sidebar-nav">
            <ul>
                <li class="active" onclick="switchSection('dashboard')">
                    <span class="nav-icon">üìä</span>
                    <span>Dashboard</span>
                </li>
                <li onclick="switchSection('users')">
                    <span class="nav-icon">üë•</span>
                    <span>Usuarios</span>
                </li>
                <li onclick="switchSection('entradas')">
                    <span class="nav-icon">üé´</span>
                    <span>Entradas</span>
                </li>
                <li onclick="switchSection('products')">
                    <span class="nav-icon">üõçÔ∏è</span>
                    <span>Productos</span>
                </li>
                <li onclick="switchSection('orders')">
                    <span class="nav-icon">üì¶</span>
                    <span>Pedidos</span>
                </li>

                <li onclick="switchSection('tickets')">
                    <span class="nav-icon">üéüÔ∏è</span>
                    <span>Validar Tickets</span>
                </li>
            </ul>
        </nav>

        <div class="sidebar-footer">
            <div class="admin-info">
                <div class="admin-avatar" id="adminAvatar">A</div>
                <div class="admin-details">
                    <span class="admin-name" id="adminName">Admin</span>
                    <span class="admin-role">Administrador</span>
                </div>
            </div>
            <button class="btn-logout" onclick="logoutAdmin()">Cerrar Sesi√≥n</button>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="admin-main">
        <!-- Header -->
        <header class="admin-header">
            <div class="header-title">
                <h1 id="sectionTitle">Dashboard</h1>
                <p id="sectionSubtitle">Vista general del sistema</p>
            </div>
            <div class="header-actions">
                <span class="current-date" id="currentDate"></span>
            </div>
        </header>

        <!-- Dashboard Section -->
        <section id="section-dashboard" class="admin-section active">
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon users">üë•</div>
                    <div class="stat-info">
                        <span class="stat-value" id="statUsers">-</span>
                        <span class="stat-label">Usuarios Registrados</span>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon orders">üì¶</div>
                    <div class="stat-info">
                        <span class="stat-value" id="statOrders">-</span>
                        <span class="stat-label">Pedidos Totales</span>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon revenue">üí∞</div>
                    <div class="stat-info">
                        <span class="stat-value" id="statBilled">-</span>
                        <span class="stat-label">Ingresos por Ventas</span>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon circulation">üëª</div>
                    <div class="stat-info">
                        <span class="stat-value" id="statCirculation">-</span>
                        <span class="stat-label">Puntos en Circulaci√≥n</span>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon tickets">üéüÔ∏è</div>
                    <div class="stat-info">
                        <span class="stat-value" id="statTickets">-</span>
                        <span class="stat-label">Tickets Vendidos</span>
                    </div>
                </div>
            </div>

            <div class="dashboard-grid">
                <div class="dashboard-card">
                    <h3>Pedidos Recientes</h3>
                    <div class="recent-list" id="recentOrders">
                        <p class="loading">Cargando...</p>
                    </div>
                </div>
                <div class="dashboard-card">
                    <h3>Usuarios Nuevos</h3>
                    <div class="recent-list" id="recentUsers">
                        <p class="loading">Cargando...</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Users Section -->
        <section id="section-users" class="admin-section">
            <div class="section-toolbar">
                <div class="search-box">
                    <input type="text" id="searchUsers" placeholder="Buscar usuarios..." onkeyup="filterUsers()">
                </div>
                <button class="btn-primary" onclick="openUserModal()">+ Nuevo Usuario</button>
            </div>
            <div class="data-table-container">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Usuario</th>
                            <th>Email</th>
                            <th>Nombre</th>
                            <th>Rol</th>
                            <th>Estado</th>
                            <th>Proveedor</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody id="usersTableBody">
                        <tr>
                            <td colspan="8" class="loading">Cargando usuarios...</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </section>

        <!-- Entradas (Tickets) Section -->
        <section id="section-entradas" class="admin-section">
            <div class="section-toolbar">
                <div class="search-box">
                    <input type="text" id="searchEntradas" placeholder="Buscar entradas..." onkeyup="filterEntradas()">
                </div>
                <button class="btn-primary" onclick="openEntradaModal()">+ Nueva Entrada</button>
            </div>
            <div class="data-table-container">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Nombre</th>
                            <th>Tipo de Ticket</th>
                            <th>Precio</th>
                            <th>Stock</th>
                            <th>Evento</th>
                            <th>Estado</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody id="entradasTableBody">
                        <tr>
                            <td colspan="8" class="loading">Cargando entradas...</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </section>

        <!-- Products Section (Merchandise, Bebidas, Comida) -->
        <section id="section-products" class="admin-section">
            <div class="section-toolbar">
                <div class="search-box">
                    <input type="text" id="searchProducts" placeholder="Buscar productos..." onkeyup="filterProducts()">
                </div>
                <select id="filterProductType" onchange="filterProducts()">
                    <option value="">Todos los tipos</option>
                    <option value="merchandise">Merchandise</option>
                    <option value="drink">Bebidas</option>
                    <option value="food">Comida</option>
                    <option value="experience">Experiencias</option>
                </select>
                <button class="btn-primary" onclick="openProductModal()">+ Nuevo Producto</button>
            </div>
            <div class="data-table-container">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Nombre</th>
                            <th>Tipo</th>
                            <th>Categor√≠a</th>
                            <th>Precio</th>
                            <th>Stock</th>
                            <th>Estado</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody id="productsTableBody">
                        <tr>
                            <td colspan="8" class="loading">Cargando productos...</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </section>

        <!-- Orders Section -->
        <section id="section-orders" class="admin-section">
            <div class="section-toolbar">
                <div class="search-box">
                    <input type="text" id="searchOrders" placeholder="Buscar por n√∫mero de orden..."
                        onkeyup="filterOrders()">
                </div>
                <select id="filterOrderStatus" onchange="filterOrders()">
                    <option value="">Todos los estados</option>
                    <option value="pending">Pendiente</option>
                    <option value="confirmed">Confirmado</option>
                    <option value="paid">Pagado</option>
                    <option value="completed">Completado</option>
                    <option value="cancelled">Cancelado</option>
                </select>
            </div>
            <div class="data-table-container">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Orden #</th>
                            <th>Cliente</th>
                            <th>Email</th>
                            <th>Total</th>
                            <th>Estado</th>
                            <th>Pago</th>
                            <th>Fecha</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody id="ordersTableBody">
                        <tr>
                            <td colspan="8" class="loading">Cargando pedidos...</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </section>



        <!-- Validate Tickets Section -->
        <section id="section-tickets" class="admin-section">
            <div class="ticket-validator">
                <h2>Validar Ticket</h2>
                <p>Escanea el c√≥digo QR con la c√°mara o ingresa el c√≥digo manualmente</p>

                <!-- QR SCANNER AREA -->
                <div class="qr-scanner-area" id="qrScannerArea">
                    <!-- Bot√≥n para iniciar esc√°ner -->
                    <button class="btn-qr-scan" id="btnStartScan" onclick="startQRScanner()">
                        üì∑ Escanear QR con C√°mara
                    </button>

                    <!-- Vista de c√°mara (oculta hasta activar) -->
                    <div class="qr-camera-container hidden" id="qrCameraContainer">
                        <video id="qrVideo" class="qr-video" autoplay muted playsinline></video>
                        <canvas id="qrCanvas" class="hidden"></canvas>
                        <div class="qr-overlay-frame">
                            <div class="qr-corner top-left"></div>
                            <div class="qr-corner top-right"></div>
                            <div class="qr-corner bottom-left"></div>
                            <div class="qr-corner bottom-right"></div>
                        </div>
                        <p class="qr-scan-status" id="qrScanStatus">üì° Apunta la c√°mara al c√≥digo QR del ticket...</p>
                        <button class="btn-qr-cancel" onclick="stopQRScanner()">‚úñ Cancelar Esc√°ner</button>
                    </div>

                    <!-- Mensaje de compatibilidad -->
                    <div class="qr-not-supported hidden" id="qrNotSupported">
                        ‚ö†Ô∏è Tu navegador no soporta el esc√°ner QR. Usa el campo manual de abajo.
                    </div>
                </div>

                <!-- SEPARADOR -->
                <div class="validator-divider">
                    <span>‚Äî o ingresa el c√≥digo manualmente ‚Äî</span>
                </div>

                <!-- INPUT MANUAL (sin cambios) -->
                <div class="validator-input">
                    <input type="text" id="ticketCodeInput" placeholder="Ingresa el c√≥digo del ticket (ej: TKT-1-123)">
                    <button class="btn-primary" onclick="validateTicket()">Validar</button>
                </div>

                <div id="validationResult" class="validation-result hidden">
                    <!-- Resultado de validaci√≥n aparece aqu√≠ -->
                </div>
            </div>
        </section>

    </main>

    <!-- User Modal -->
    <div id="userModal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="userModalTitle">Nuevo Usuario</h2>
                <button class="modal-close" onclick="closeUserModal()">&times;</button>
            </div>
            <form id="userForm" onsubmit="saveUser(event)">
                <input type="hidden" id="userId">
                <div class="form-group">
                    <label>Username</label>
                    <input type="text" id="userUsername" required minlength="3">
                </div>
                <div class="form-group">
                    <label>Email</label>
                    <input type="email" id="userEmail" required>
                </div>
                <div class="form-group">
                    <label>Contrase√±a <small>(dejar vac√≠o para no cambiar)</small></label>
                    <input type="password" id="userPassword" minlength="6">
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Nombre</label>
                        <input type="text" id="userFirstName">
                    </div>
                    <div class="form-group">
                        <label>Apellido</label>
                        <input type="text" id="userLastName">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Rol</label>
                        <select id="userRole">
                            <option value="user">Usuario</option>
                            <option value="vip">VIP</option>
                            <option value="moderator">Moderador</option>
                            <option value="admin">Administrador</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Estado</label>
                        <select id="userActive">
                            <option value="true">Activo</option>
                            <option value="false">Inactivo</option>
                        </select>
                    </div>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn-secondary" onclick="closeUserModal()">Cancelar</button>
                    <button type="submit" class="btn-primary">Guardar</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Entrada (Ticket) Modal -->
    <div id="entradaModal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="entradaModalTitle">Nueva Entrada</h2>
                <button class="modal-close" onclick="closeEntradaModal()">&times;</button>
            </div>
            <form id="entradaForm" onsubmit="saveEntrada(event)">
                <input type="hidden" id="entradaId">
                <div class="form-group">
                    <label>Nombre de la Entrada</label>
                    <input type="text" id="entradaName" required placeholder="ej: Ticket VIP">
                </div>
                <div class="form-group">
                    <label>Descripci√≥n</label>
                    <textarea id="entradaDescription" rows="3" placeholder="Describe qu√© incluye esta entrada..."></textarea>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Tipo de Ticket</label>
                        <select id="entradaTicketType" required>
                            <option value="general">General</option>
                            <option value="vip">VIP</option>
                            <option value="premium">Premium</option>
                            <option value="early_bird">Early Bird</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Categor√≠a</label>
                        <input type="text" id="entradaCategory" value="entrada" placeholder="ej: entrada">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Precio (‚Ç¨)</label>
                        <input type="number" id="entradaPrice" step="0.01" min="0" required>
                    </div>
                    <div class="form-group">
                        <label>Stock Disponible</label>
                        <input type="number" id="entradaStock" min="0" required value="100">
                    </div>
                </div>
                <div class="form-group">
                    <label>Imagen del Pase</label>
                    <div class="image-upload-container">
                        <input type="file" id="entradaImageFile" accept="image/*" onchange="uploadImage('entrada')">
                        <input type="hidden" id="entradaImage"> <!-- Original ID kept for compatibility -->
                        <div id="entradaImagePreview" class="image-preview hidden">
                            <img id="entradaImagePreviewImg" src="" alt="Vista previa">
                            <button type="button" class="btn-icon delete" onclick="removeImage('entrada')" title="Eliminar imagen">‚ùå</button>
                        </div>
                        <div id="entradaUploadStatus" class="upload-status"></div>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Estado</label>
                        <select id="entradaActive">
                            <option value="true">Activo (a la venta)</option>
                            <option value="false">Inactivo (oculto)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Destacado</label>
                        <select id="entradaFeatured">
                            <option value="false">No</option>
                            <option value="true">S√≠ (mostrar primero)</option>
                        </select>
                    </div>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn-secondary" onclick="closeEntradaModal()">Cancelar</button>
                    <button type="submit" class="btn-primary" id="saveEntradaBtn">Guardar Entrada</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Product Modal (Sin Tickets) -->
    <div id="productModal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="productModalTitle">Nuevo Producto</h2>
                <button class="modal-close" onclick="closeProductModal()">&times;</button>
            </div>
            <form id="productForm" onsubmit="saveProduct(event)">
                <input type="hidden" id="productId">
                <div class="form-group">
                    <label>Nombre</label>
                    <input type="text" id="productName" required>
                </div>
                <div class="form-group">
                    <label>Descripci√≥n</label>
                    <textarea id="productDescription" rows="3"></textarea>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Tipo</label>
                        <select id="productType" required>
                            <option value="merchandise">Merchandise</option>
                            <option value="drink">Bebida</option>
                            <option value="food">Comida</option>
                            <option value="experience">Experiencia</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Categor√≠a</label>
                        <input type="text" id="productCategory" placeholder="ej: accesorios">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Precio (‚Ç¨)</label>
                        <input type="number" id="productPrice" step="0.01" min="0" required>
                    </div>
                    <div class="form-group">
                        <label>Stock</label>
                        <input type="number" id="productStock" min="0" required>
                    </div>
                </div>
                <div class="form-group">
                    <label>Imagen</label>
                     <div class="image-upload-container">
                        <input type="file" id="productImageFile" accept="image/*" onchange="uploadImage('product')">
                        <input type="hidden" id="productImage"> <!-- Original ID kept for compatibility -->
                        <div id="productImagePreview" class="image-preview hidden">
                            <img id="productImagePreviewImg" src="" alt="Vista previa">
                             <button type="button" class="btn-icon delete" onclick="removeImage('product')" title="Eliminar imagen">‚ùå</button>
                        </div>
                         <div id="productUploadStatus" class="upload-status"></div>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Estado</label>
                        <select id="productActive">
                            <option value="true">Activo</option>
                            <option value="false">Inactivo</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Destacado</label>
                        <select id="productFeatured">
                            <option value="false">No</option>
                            <option value="true">S√≠</option>
                        </select>
                    </div>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn-secondary" onclick="closeProductModal()">Cancelar</button>
                    <button type="submit" class="btn-primary">Guardar</button>
                </div>
            </form>
        </div>
    </div>


    <div id="orderModal" class="modal hidden">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h2>Detalle de Pedido <span id="orderModalNumber"></span></h2>
                <button class="modal-close" onclick="closeOrderModal()">&times;</button>
            </div>
            <div id="orderModalContent">
                <!-- Contenido din√°mico -->
            </div>
        </div>
    </div>

    <script type="module" src="../assets/js/admin.js?v=4"></script>
</body>

</html>